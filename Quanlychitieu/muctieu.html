<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QL Ng√¢n Qu·ªπ - M·ª•c ti√™u</title>
  <link rel="stylesheet" href="index.css">
  <style>
    .modal {
      display: none; 
      position: fixed; 
      z-index: 1000; 
      left: 0; top: 0; 
      width: 100%; height: 100%; 
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: #fff; 
      padding: 25px; 
      border-radius: 8px; 
      width: 450px; 
      max-width: 90%;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b; }
    .form-input {
      width: 100%; 
      padding: 10px; 
      border: 1px solid #cbd5e1; 
      border-radius: 6px; 
      font-size: 14px;
    }
    .modal-footer {
      display: flex; 
      justify-content: flex-end; 
      gap: 10px; 
      margin-top: 20px;
    }
    .badge.success {
      background-color: #dcfce7;
      color: #166534;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
    }
  </style>
</head>
<body ng-app="walletApp">
  <header class="header">
    <div class="header-container">
      <div class="logo"><h1>QL Ng√¢n Qu·ªπ</h1></div>
      <div class="header-search">
        <input type="text" ng-model="vm.searchText" placeholder="T√¨m ki·∫øm m·ª•c ti√™u...">
      </div>
      <div class="header-right">
        <div class="avatar-dropdown">
          <img src="https://via.placeholder.com/40" alt="Avatar" class="avatar-img">
          <span class="user-name">{{vm.tenNguoiDung}}</span>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item">H·ªì s∆°</a>
            <a href="#" class="dropdown-item">ƒê·ªïi m·∫≠t kh·∫©u</a>
            <a href="#" class="dropdown-item" id="btnLogoutUser">ƒêƒÉng xu·∫•t</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <nav class="nav">
    <div class="nav-container">
      <a href="index.html" class="nav-item">T·ªïng quan</a>
      <a href="giaodich.html" class="nav-item">Giao d·ªãch</a>
      <a href="vi.html" class="nav-item">V√≠</a>
      <a href="danhmuc.html" class="nav-item">Danh m·ª•c</a>
      <a href="ngansach.html" class="nav-item">Ng√¢n s√°ch</a>
      <a href="muctieu.html" class="nav-item active">M·ª•c ti√™u</a>
    </div>
  </nav>

  <main class="container" ng-controller="MucTieuCtrl as vm">
    <div class="grid">
      <div class="left">
        <div class="card">
          <div class="card-header">
            <h2>M·ª•c ti√™u ti·∫øt ki·ªám</h2>
            <button class="btn btn-primary" ng-click="vm.moModalThem()">+ T·∫°o m·ª•c ti√™u</button>
          </div>

          <div class="table-wrap">
            <table class="goal-table">
              <thead>
                <tr>
                  <th>T√™n m·ª•c ti√™u</th>
                  <th>Ti·∫øn ƒë·ªô</th>
                  <th>Th·ªùi h·∫°n</th>
                  <th>Ghi ch√∫</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-if="vm.loading">
                  <td colspan="5" style="text-align:center; padding:20px; color:#64748b;">
                    ƒêang t·∫£i danh s√°ch m·ª•c ti√™u...
                  </td>
                </tr>

                <tr ng-if="!vm.loading && vm.danhSach.length === 0">
                  <td colspan="5" style="text-align:center; padding:30px; color:#64748b;">
                    Ch∆∞a c√≥ m·ª•c ti√™u ti·∫øt ki·ªám n√†o.<br>
                    Nh·∫•n n√∫t <strong>+ T·∫°o m·ª•c ti√™u</strong> ƒë·ªÉ b·∫Øt ƒë·∫ßu!
                  </td>
                </tr>

                <tr ng-repeat="goal in vm.danhSach | filter:vm.searchText track by goal.id">
                  <td>
                    <strong>{{goal.tenMucTieu}}</strong>
                    <span ng-if="goal.soTienDaDat >= goal.soTienCanDat" class="badge success" style="margin-left:8px;">
                      Ho√†n th√†nh üéâ
                    </span>
                  </td>
                  <td>
                    <div class="progress">
                      <div class="progress-bar" 
                           ng-style="{ 'width': (goal.soTienDaDat / goal.soTienCanDat * 100) + '%' }"
                           ng-class="{'complete': goal.soTienDaDat >= goal.soTienCanDat}"></div>
                    </div>
                    <small>
                      {{goal.soTienDaDat | number:0}} / {{goal.soTienCanDat | number:0}} ‚Ç´
                    </small>
                  </td>
                  <td>{{goal.hanHoanThanh | date:'dd/MM/yyyy' || '-'}}</td>
                  <td>{{goal.moTa || '-'}}</td>
                  <td>
                    <button class="btn btn-outline btn-sm"
                            ng-click="vm.moDongGop(goal)"
                            ng-disabled="goal.soTienDaDat >= goal.soTienCanDat">
                      ƒê√≥ng g√≥p
                    </button>
                    <button class="btn btn-danger btn-sm" ng-click="vm.xoaMucTieu(goal)">
                      X√≥a
                    </button>
                  </td>
                </tr>

                <tr ng-if="vm.dongGopHienTai">
                  <td colspan="5" style="padding: 16px; background:#f0f9ff; border-top: 3px solid #0ea5e9;">
                    <div style="display:flex; flex-direction:column; gap:12px;">
                      <div style="display:flex; align-items:center; font-weight:600; color:#1e40af;">
                        <span>ƒê√≥ng g√≥p cho m·ª•c ti√™u:</span>
                        <strong style="margin-left:8px;">{{vm.dongGopHienTai.tenMucTieu}}</strong>
                      </div>
                      <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                        <input type="number" ng-model="vm.soTienDongGop" placeholder="Nh·∫≠p s·ªë ti·ªÅn ƒë√≥ng g√≥p (‚Ç´)" min="1" class="form-input" style="flex:1; min-width:220px;" required />
                        <button class="btn btn-success" ng-click="vm.xacNhanDongGop()">X√°c nh·∫≠n</button>
                        <button class="btn btn-outline" ng-click="vm.huyDongGop()">H·ªßy</button>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>L·ªãch s·ª≠ ƒë√≥ng g√≥p</h2>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Ng√†y</th>
                  <th>M·ª•c ti√™u</th>
                  <th>S·ªë ti·ªÅn</th>
                  <th>Ghi ch√∫</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>09/12/2024</td>
                  <td>Du l·ªãch Nh·∫≠t B·∫£n</td>
                  <td>2,000,000 ‚Ç´</td>
                  <td>ƒê√≥ng g√≥p th√°ng 12</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="card">
          <h2>G·ª£i √Ω</h2>
          <p style="color:#64748b;">
            M·ªói l·∫ßn ƒë√≥ng g√≥p m·ª•c ti√™u s·∫Ω t·∫°o m·ªôt giao d·ªãch<br>
            (DongGopMucTieu ‚Üî GiaoDich).
          </p>
        </div>
      </div>
    </div>

    <div class="modal" ng-class="{'active': vm.isModalOpen}">
      <div class="modal-content">
        <div class="modal-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <h2 style="margin:0; font-size:1.5rem; color:#1e293b;">T·∫°o m·ª•c ti√™u ti·∫øt ki·ªám</h2>
          <button ng-click="vm.dongModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
        </div>

        <form ng-submit="vm.submitModal()">
          <div class="form-group">
            <label>T√™n m·ª•c ti√™u</label>
            <input type="text" ng-model="vm.form.tenMucTieu" required class="form-input" placeholder="V√≠ d·ª•: Mua iPhone 15">
          </div>

          <div class="form-group">
            <label>S·ªë ti·ªÅn m·ª•c ti√™u (‚Ç´)</label>
            <input type="number" ng-model="vm.form.soTienCanDat" required class="form-input" placeholder="0">
          </div>

          <div class="form-group">
            <label>Th·ªùi h·∫°n ho√†n th√†nh</label>
            <input type="date" ng-model="vm.form.hanHoanThanh" required class="form-input">
          </div>

          <div class="form-group">
            <label>Ghi ch√∫</label>
            <textarea ng-model="vm.form.moTa" class="form-input" rows="3" placeholder="Nh·∫≠p ghi ch√∫..."></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-outline" ng-click="vm.dongModal()">H·ªßy b·ªè</button>
            <button type="submit" class="btn btn-primary">L∆∞u m·ª•c ti√™u</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <footer class="footer">
    <p>&copy; 2024 QL Ng√¢n Qu·ªπ.</p>
  </footer>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="auth-client.js"></script>
  <script src="muctieu.js"></script>
</body>
</html>